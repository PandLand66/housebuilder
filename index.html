<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snapbuilder App</title>
    <!-- Tailwind CSS for layout utility -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Imported Bebas Neue and Roboto */
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap');

        :root {
            --blueprint-blue: #1e5bbd;
            --blueprint-grid: #3b7adb;
            --text-stroke-color: #000;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--blueprint-blue);
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                radial-gradient(circle at center, rgba(30, 91, 189, 0.5) 0%, rgba(10, 30, 80, 0.8) 100%);
            background-size: 40px 40px, 40px 40px, 100% 100%;
            background-position: center;
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            user-select: none;
        }

        /* Blueprint decorative lines */
        .blueprint-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            pointer-events: none;
        }
        .line-h { width: 100%; height: 2px; top: 30%; left: 0; }
        .line-v { width: 2px; height: 100%; top: 0; left: 70%; }

        /* App Container Entrance Animation */
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .app-container {
            width: 90%;
            max-width: 800px;
            position: relative;
            z-index: 10;
            padding: 20px;
            animation: slideUpFade 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Typography - Bebas Neue */
        .impact-text {
            font-family: 'Bebas Neue', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 
                -1px -1px 0 #000,  
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000,
                3px 3px 5px rgba(0,0,0,0.5);
            font-size: 3rem;
            line-height: 1;
        }

        /* Layout Grid */
        .top-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        @media (min-width: 768px) {
            .top-section {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-end;
            }
        }

        /* House Display */
        .house-preview {
            position: relative;
            width: 300px;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .house-sketch {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
            transition: all 0.5s ease;
        }
        
        /* FULL SCREEN Construction Animation Overlay */
        .construction-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 20, 40, 0.6);
            backdrop-filter: blur(15px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        .construction-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        /* --- RIPPLE ANIMATION EFFECT --- */
        .ripple-btn {
            position: relative;
            overflow: hidden; 
            transform: translate3d(0, 0, 0); 
        }

        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6); 
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Generate Button */
        .btn-generate {
            background: #0f1c30;
            color: #7dd3fc;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            letter-spacing: 2px;
            padding: 10px 40px;
            border: 3px solid white;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 10px 0 rgba(0,0,0,0.5);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
            text-transform: uppercase;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 0 rgba(0,0,0,0.5);
        }

        .btn-generate:active {
            transform: translateY(5px);
            box-shadow: 0 5px 0 rgba(0,0,0,0.5);
        }
        
        .btn-generate:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: translateY(5px);
            box-shadow: 0 5px 0 rgba(0,0,0,0.5);
        }

        /* Controls Section */
        .controls-grid {
            display: grid;
            gap: 25px;
        }

        .control-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        @media (min-width: 640px) {
            .control-row {
                flex-direction: row;
                align-items: center;
            }
        }

        .label-col {
            width: 180px;
            flex-shrink: 0;
        }

        /* Material Circles & Labels */
        .material-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .mat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .mat-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: white;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000;
        }

        .mat-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        .mat-circle:hover { transform: scale(1.15); }
        .mat-circle.active { 
            box-shadow: 0 0 0 4px #4ade80; 
            transform: scale(1.1); 
        }

        /* Material Textures - Using Provided URLs */
        .mat-brick { background-image: url('https://lushfabric.com/wp-content/uploads/2021/08/brown-4-scaled.jpg'); }
        .mat-concrete { background-image: url('https://cdn.architextures.org/textures/20/11/concrete-5fc4cb651ff0f-1200.jpg'); }
        .mat-metal { background-image: url('https://usercontent.one/wp/www.scandinavian.house/wp-content/uploads/Material-Metal-Scandinavian-House-Stainless-steel.jpg'); }
        .mat-wood { background-image: url('https://timberx.co.uk/wp-content/uploads/2023/07/Complete-Guide-to-Pine-Wood-scaled.jpg'); }

        /* Slider Customization */
        .slider-container {
            flex-grow: 1;
            position: relative;
            padding: 0 10px;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 12px;
            background: #2e1a4d;
            border-radius: 6px;
            border: 2px solid white;
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #38bdf8;
            border: 3px solid white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
            margin-top: -11.5px; 
            position: relative;
            z-index: 2;
            transition: transform 0.1s;
        }
        
        input[type=range]::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }

        .slider-limit {
            position: absolute;
            bottom: -25px;
            left: 10px;
            font-size: 1rem;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 1px;
            color: white;
            text-shadow: 1px 1px 0 #000;
        }

        /* Color Picker Buttons */
        .color-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .col-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .col-circle:hover { transform: scale(1.15); }
        .col-circle.active { 
            transform: scale(1.2); 
            box-shadow: 0 0 15px rgba(255,255,255,0.8);
            border-color: #ffff00;
        }

        .col-rainbow {
            background: conic-gradient(red, yellow, lime, aqua, blue, magenta, red);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .col-rainbow::after {
            content: 'CUSTOM';
            position: absolute;
            bottom: -22px;
            font-size: 0.9rem;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 1px;
            color: white;
            text-shadow: 1px 1px 0 #000;
        }

        .color-info-bubble {
            background: rgba(0,0,0,0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8rem;
            margin-left: 10px;
            border: 1px solid white;
            display: none;
        }
        
        .color-info-bubble.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* --- FURNITURE UI STYLES --- */
        .btn-furniture {
            background: transparent;
            border: 2px solid white;
            color: white;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            padding: 5px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-furniture:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.05);
        }

        /* Common Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.open {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: #1e5bbd;
            border: 4px solid white;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.8);
            opacity: 0;
        }
        
        /* Modal Specifics */
        .welcome-box {
            max-width: 600px;
            padding: 40px;
            text-align: center;
        }

        .furniture-box {
            width: 95%;
            max-width: 900px;
            height: 80vh;
        }
        
        .color-box {
            width: 90%;
            max-width: 500px;
            padding: 0;
            border: 3px solid white;
        }

        /* Animation Keyframes */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }

        .modal-overlay.open .modal-content {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 1;
            transform: scale(1);
        }

        .modal-header {
            background: #0f1c30;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid white;
        }

        .modal-body {
            flex-grow: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Welcome Text */
        .welcome-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            color: #e0f2fe;
            font-style: italic;
        }

        .btn-start {
            background: #4ade80;
            color: #0f1c30;
            border: 3px solid white;
            padding: 10px 40px;
            font-family: 'Bebas Neue';
            font-size: 2rem;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-start:hover { transform: scale(1.05); }

        /* Furniture Sidebar */
        .furniture-palette {
            width: 140px;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-right: 2px solid rgba(255,255,255,0.2);
            overflow-y: auto; 
            height: 100%;
            flex-shrink: 0;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.5) transparent;
        }

        .furniture-palette::-webkit-scrollbar { width: 6px; }
        .furniture-palette::-webkit-scrollbar-track { background: transparent; }
        .furniture-palette::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.3); border-radius: 20px; }

        .palette-item {
            width: 100%;
            min-height: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border: 2px solid white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.2s;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .palette-item:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .palette-item.active-mode {
            background: #4ade80;
            color: #0f1c30;
            border-color: #0f1c30;
        }

        .palette-item i { font-size: 1.8rem; margin-bottom: 5px; }
        .palette-item span { font-size: 0.9rem; font-family: 'Bebas Neue'; letter-spacing: 1px; }

        .room-canvas {
            flex-grow: 1;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.2) 1px, transparent 1px);
            background-size: 40px 40px;
            position: relative;
            overflow: hidden;
        }

        .room-canvas.draw-mode { cursor: crosshair; }
        .room-canvas.move-mode { cursor: default; }

        .room-label {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Bebas Neue';
            font-size: 5rem;
            color: rgba(255,255,255,0.1);
            pointer-events: none;
            user-select: none;
        }

        /* Wall Drawing Layer */
        .wall-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        .room-canvas.draw-mode .wall-layer { pointer-events: auto; }

        /* Draggable Furniture on Canvas */
        .furniture-piece {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border: 2px solid #0f1c30;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1e5bbd;
            font-size: 1.5rem;
            cursor: move;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            user-select: none;
            touch-action: none; 
            z-index: 20;
            transition: transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .room-canvas.draw-mode .furniture-piece { pointer-events: none; opacity: 0.5; }
        .room-canvas.move-mode .furniture-piece { cursor: move; pointer-events: auto; }

        .furniture-piece:active {
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .btn-close-modal {
            background: #4ade80;
            color: #0f1c30;
            border: none;
            padding: 5px 20px;
            font-family: 'Bebas Neue';
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        /* Timer/Progress Bar */
        .progress-container {
            width: 300px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            display: none;
            border: 2px solid white;
        }
        
        .progress-bar {
            height: 100%;
            background: #4ade80;
            width: 0%;
            transition: width 1s linear;
        }

        /* --- NEW COLOR PICKER MODAL STYLES --- */
        .color-modal-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #1e5bbd; /* Blueprint Blue */
            gap: 15px;
        }

        .color-preview-box {
            width: 100%;
            height: 100px;
            border: 3px solid white;
            border-radius: 10px;
            background: white;
            transition: background 0.3s;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        .hex-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 300px;
        }

        .hex-cell {
            width: 40px;
            height: 40px;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            background-color: #fff;
            cursor: pointer;
            transition: transform 0.2s;
            /* WHITE OUTLINE via filter drop-shadow */
            filter: drop-shadow(0 0 1px #fff) drop-shadow(0 0 1px #fff);
            margin: 2px;
        }

        .hex-cell:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        
        .hue-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 10px;
            background: linear-gradient(to right, red, orange, yellow, lime, cyan, blue, magenta, red);
            outline: none;
            border: 2px solid white;
            cursor: pointer;
            transition: opacity 0.3s, filter 0.3s;
        }
        
        /* Disabled state for hue slider */
        .hue-slider:disabled {
            opacity: 0.4;
            filter: grayscale(100%);
            cursor: not-allowed;
        }
        
        .hue-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            border: 2px solid #333;
            cursor: pointer;
        }

        .brightness-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 10px;
            background: linear-gradient(to right, black, white); /* Default, updated by JS */
            outline: none;
            border: 2px solid white;
            cursor: pointer;
        }
        
        .brightness-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            border: 2px solid #333;
            cursor: pointer;
        }

        .hex-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            background: rgba(0,0,0,0.2);
            padding: 5px 10px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .hex-input {
            background: transparent;
            border: none;
            color: white;
            font-family: monospace;
            font-size: 1.2rem;
            width: 100%;
            outline: none;
            text-transform: uppercase;
        }

        #customColorInput { position: absolute; opacity: 0; pointer-events: none; }

    </style>
</head>
<body>

    <div class="blueprint-line line-h"></div>
    <div class="blueprint-line line-v"></div>

    <!-- WELCOME MODAL -->
    <div class="modal-overlay open" id="welcomeModal">
        <div class="modal-content welcome-box">
            <div class="impact-text" style="font-size: 3.5rem;">Welcome</div>
            <p class="welcome-text">
                "Thank you for purchasing this innovative device, this will solve a big problem with housing prices, because it's so cheap! I started working on this product for years, after lots of trial testing and failed attempts, it finally works!"
            </p>
            <button class="btn-start ripple-btn" onclick="closeWelcomeModal()">LET'S BUILD</button>
        </div>
    </div>

    <!-- FULL SCREEN CONSTRUCTION OVERLAY -->
    <div class="construction-overlay" id="constructionOverlay">
        <i class="fas fa-hammer fa-spin fa-4x" style="color: white; margin-bottom: 20px;"></i>
        <span class="impact-text" style="font-size: 4rem;">Building...</span>
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div id="countdown" style="margin-top: 15px; font-family: monospace; font-size: 2rem; color: white;">10s</div>
    </div>

    <!-- NEW CUSTOM COLOR MODAL -->
    <div class="modal-overlay" id="colorModal">
        <div class="modal-content color-box">
            <div class="modal-header">
                <div class="impact-text" style="font-size: 2rem;">Select Colour</div>
                <!-- Close X -->
                <i class="fas fa-times cursor-pointer" style="font-size: 1.5rem;" onclick="closeColorModal()"></i>
            </div>
            <div class="color-modal-body">
                <!-- Large Preview -->
                <div class="color-preview-box" id="modalColorPreview"></div>
                
                <!-- Hue Slider -->
                <div style="width:100%">
                    <label style="font-size:0.8rem; opacity:0.8;">HUE</label>
                    <input type="range" class="hue-slider" min="0" max="360" value="0" id="hueSlider" oninput="updateColorFromControls()">
                </div>
                
                <!-- Brightness Slider -->
                <div style="width:100%">
                    <label style="font-size:0.8rem; opacity:0.8;">BRIGHTNESS</label>
                    <input type="range" class="brightness-slider" min="0" max="100" value="50" id="lightnessSlider" oninput="updateColorFromControls()">
                </div>

                <!-- Hexagon Grid -->
                <div class="hex-grid" id="hexGrid">
                    <!-- JS will populate -->
                </div>

                <!-- Hex Input -->
                <div class="hex-input-row">
                    <span style="font-family: monospace;">#</span>
                    <input type="text" class="hex-input" id="modalHexInput" value="FFFFFF" oninput="updateFromHexInput(this.value)" maxlength="6">
                </div>

                <!-- Action Buttons -->
                <div style="display:flex; gap: 10px; width: 100%; margin-top: 10px;">
                     <button class="btn-close-modal ripple-btn" style="background:#ef4444; flex:1;" onclick="closeColorModal()">CANCEL</button>
                     <button class="btn-close-modal ripple-btn" style="flex:1;" onclick="confirmColorModal()">SELECT</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FURNITURE MODAL -->
    <div class="modal-overlay" id="furnitureModal">
        <div class="modal-content furniture-box">
            <div class="modal-header">
                <div class="impact-text" style="font-size: 2rem;">Interior Layout</div>
                <button class="btn-close-modal ripple-btn" onclick="closeFurnitureModal()">DONE</button>
            </div>
            <div class="modal-body">
                <!-- Sidebar -->
                <div class="furniture-palette">
                    <!-- Modes -->
                    <div class="palette-item active-mode ripple-btn" id="btnMoveMode" onclick="setMode('move')">
                        <i class="fas fa-hand-paper"></i>
                        <span>Move</span>
                    </div>
                    <div class="palette-item ripple-btn" id="btnDrawMode" onclick="setMode('draw')">
                        <i class="fas fa-pencil-ruler"></i>
                        <span>Draw Wall</span>
                    </div>
                    
                    <div style="width: 100%; min-height: 2px; height: 2px; background: rgba(255,255,255,0.2); margin: 5px 0; flex-shrink: 0;"></div>

                    <!-- Items -->
                    <div class="palette-item ripple-btn" onclick="addFurniture('couch')">
                        <i class="fas fa-couch"></i>
                        <span>Sofa</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('bed')">
                        <i class="fas fa-bed"></i>
                        <span>Bed</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('tv')">
                        <i class="fas fa-tv"></i>
                        <span>TV</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('lightbulb')">
                        <i class="fas fa-lightbulb"></i>
                        <span>Lamp</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('chair')">
                        <i class="fas fa-chair"></i>
                        <span>Chair</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('leaf')">
                        <i class="fas fa-leaf"></i>
                        <span>Plant</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('toilet')">
                        <i class="fas fa-toilet"></i>
                        <span>Toilet</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('bath')">
                        <i class="fas fa-bath"></i>
                        <span>Bath</span>
                    </div>
                    <div class="palette-item ripple-btn" onclick="addFurniture('table')">
                        <i class="fas fa-table"></i>
                        <span>Table</span>
                    </div>
                    <div class="palette-item ripple-btn" style="margin-top:auto; background: #ef4444;" onclick="clearRoom()">
                        <i class="fas fa-trash"></i>
                        <span>Clear All</span>
                    </div>
                </div>
                <!-- Canvas -->
                <div class="room-canvas move-mode" id="roomCanvas">
                    <div class="room-label">FLOOR PLAN</div>
                    <!-- SVG Layer for Drawing Walls -->
                    <svg class="wall-layer" id="wallLayer" onmousedown="startWall(event)" onmousemove="drawWall(event)" onmouseup="endWall(event)" ontouchstart="startWall(event)" ontouchmove="drawWall(event)" ontouchend="endWall(event)">
                        <!-- Walls will be lines here -->
                    </svg>
                    <!-- Furniture items will be appended here -->
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        
        <!-- TOP SECTION -->
        <div class="top-section">
            <div class="house-preview" id="housePreview">
                <!-- Detailed Blueprint House SVG -->
                <svg id="houseSvg" class="house-sketch" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 220" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="50" y="100" width="140" height="100" stroke="white" stroke-width="3"/>
                    <rect x="190" y="130" width="80" height="70" stroke="white" stroke-width="3"/>
                    <rect x="200" y="145" width="60" height="55" stroke="white" stroke-width="2"/>
                    <path d="M200 155 H260 M200 165 H260 M200 175 H260 M200 185 H260" stroke="white" stroke-width="1"/>
                    <path d="M40 100 L120 30 L200 100" stroke="white" stroke-width="4" stroke-linejoin="round"/>
                    <path d="M190 130 L275 130" stroke="white" stroke-width="3"/>
                    <rect x="150" y="45" width="20" height="30" stroke="white" stroke-width="3"/>
                    <rect x="105" y="140" width="30" height="60" stroke="white" stroke-width="3"/>
                    <circle cx="130" cy="170" r="2" fill="white"/>
                    <rect x="60" y="120" width="30" height="30" stroke="white" stroke-width="2"/>
                    <path d="M75 120 V150 M60 135 H90" stroke="white" stroke-width="1"/>
                    <rect x="150" y="120" width="30" height="30" stroke="white" stroke-width="2"/>
                    <path d="M165 120 V150 M150 135 H180" stroke="white" stroke-width="1"/>
                    <circle cx="120" cy="75" r="10" stroke="white" stroke-width="2"/>
                    <path d="M120 65 V85 M110 75 H130" stroke="white" stroke-width="1"/>
                    <path d="M20 200 Q150 210 280 200" stroke="white" stroke-width="2" stroke-dasharray="5 5"/>
                </svg>
            </div>

            <div style="display:flex; flex-direction:column; align-items:center; gap: 10px;">
                <button class="btn-generate ripple-btn" id="generateBtn" onclick="startGeneration()">Generate</button>
            </div>
        </div>

        <!-- CONTROLS SECTION -->
        <div class="controls-grid">

            <!-- Furniture Button Row -->
             <div class="control-row" style="justify-content: flex-end;">
                 <div class="label-col" style="display:none;"></div> <!-- Spacer -->
                 <button class="btn-furniture ripple-btn" onclick="openFurnitureModal()">
                    <i class="fas fa-pen-ruler"></i> Furnish
                 </button>
             </div>

            <!-- Material Selection -->
            <div class="control-row">
                <div class="label-col">
                    <div class="impact-text">Material:</div>
                </div>
                <div class="material-options">
                    <div class="mat-item">
                        <div class="mat-circle mat-brick active ripple-btn" onclick="selectMaterial(this, 'brick')" title="Brick"></div>
                        <span class="mat-label">Brick</span>
                    </div>
                    <div class="mat-item">
                        <div class="mat-circle mat-concrete ripple-btn" onclick="selectMaterial(this, 'concrete')" title="Concrete"></div>
                        <span class="mat-label">Concrete</span>
                    </div>
                    <div class="mat-item">
                        <div class="mat-circle mat-metal ripple-btn" onclick="selectMaterial(this, 'metal')" title="Metal"></div>
                        <span class="mat-label">Metal</span>
                    </div>
                    <div class="mat-item">
                        <div class="mat-circle mat-wood ripple-btn" onclick="selectMaterial(this, 'wood')" title="Wood"></div>
                        <span class="mat-label">Wood</span>
                    </div>
                </div>
            </div>

            <!-- Size Slider -->
            <div class="control-row">
                <div class="label-col">
                    <div class="impact-text" id="sizeLabel">Size: 70M²</div>
                </div>
                <div class="slider-container">
                    <input type="range" min="30" max="80" value="70" id="sizeSlider" oninput="updateSize(this.value)">
                    <div class="slider-limit">SIZE LIMIT: 80M²</div>
                </div>
            </div>

            <!-- Color Picker -->
            <div class="control-row">
                <div class="label-col">
                    <div class="impact-text">Colour:</div>
                </div>
                <div class="color-options">
                    <div class="col-circle col-rainbow ripple-btn" id="customColorBtn" onclick="openColorModal()" title="Custom Color">
                        <i class="fas fa-eye-dropper" style="font-size: 1.2rem; color: rgba(0,0,0,0.5);"></i>
                    </div>
                    <input type="color" id="customColorInput" style="display:none;">

                    <div class="col-circle ripple-btn" style="background-color: #a0522d;" onclick="selectColor(this, '#a0522d')"></div>
                    <div class="col-circle ripple-btn" style="background-color: #f4a460;" onclick="selectColor(this, '#f4a460')"></div>
                    <div class="col-circle ripple-btn" style="background-color: #ffffff;" onclick="selectColor(this, '#ffffff')"></div>
                    <div class="col-circle ripple-btn" style="background-color: #f5deb3;" onclick="selectColor(this, '#f5deb3')"></div>
                    <div class="col-circle ripple-btn" style="background-color: #d2b48c;" onclick="selectColor(this, '#d2b48c')"></div>
                    <div class="col-circle ripple-btn" style="background-color: #708090;" onclick="selectColor(this, '#708090')"></div>

                    <div class="color-info-bubble" id="colorInfo">
                        HEX: <span id="hexValue">#FFFFFF</span><br>
                        RGB: <span id="rgbValue">255, 255, 255</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- RIPPLE EFFECT JS ---
        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;
            const rect = button.getBoundingClientRect();
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - rect.left - radius}px`;
            circle.style.top = `${event.clientY - rect.top - radius}px`;
            circle.classList.add("ripple-effect");
            const ripple = button.getElementsByClassName("ripple-effect")[0];
            if (ripple) ripple.remove();
            button.appendChild(circle);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.getElementsByClassName("ripple-btn");
            for (const button of buttons) {
                button.addEventListener("click", createRipple);
            }
            populateHexGrid();
        });

        // State
        let currentMaterial = 'brick';
        let currentColor = '#ffffff';
        
        // HSL State for Color Modal
        let modalHue = 0;
        let modalSat = 100;
        let modalLight = 50;
        let tempColor = '#ffffff'; 

        let isGenerating = false;
        let layoutMode = 'move'; 

        // --- WELCOME MODAL ---
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.remove('open');
        }

        // --- FURNITURE MODAL ---
        function openFurnitureModal() {
            document.getElementById('furnitureModal').classList.add('open');
        }
        function closeFurnitureModal() {
            document.getElementById('furnitureModal').classList.remove('open');
        }

        // --- COLOR MODAL LOGIC ---
        function openColorModal() {
            document.getElementById('colorModal').classList.add('open');
            const hsl = hexToHSL(currentColor);
            modalHue = hsl.h;
            modalSat = hsl.s;
            modalLight = hsl.l;
            
            document.getElementById('hueSlider').value = modalHue;
            document.getElementById('lightnessSlider').value = modalLight;
            
            updateColorFromControls();
        }

        function closeColorModal() {
            document.getElementById('colorModal').classList.remove('open');
        }

        function confirmColorModal() {
            applyCustomColor(tempColor);
            closeColorModal();
        }

        function populateHexGrid() {
            const grid = document.getElementById('hexGrid');
            const colors = [
                '#ff0000', '#ff8800', '#ffff00', '#88ff00', '#00ff00', 
                '#00ff88', '#00ffff', '#0088ff', '#0000ff', '#8800ff',
                '#ff00ff', '#ff0088', '#ffffff', '#aaaaaa', '#555555', 
                '#000000', '#604020', '#a0522d', '#f4a460', '#f5deb3'
            ];
            
            colors.forEach(c => {
                const hex = document.createElement('div');
                hex.className = 'hex-cell';
                hex.style.backgroundColor = c;
                hex.onclick = () => {
                    const hsl = hexToHSL(c);
                    modalHue = hsl.h;
                    modalSat = hsl.s; 
                    modalLight = hsl.l;
                    document.getElementById('hueSlider').value = modalHue;
                    document.getElementById('lightnessSlider').value = modalLight;
                    updateColorFromControls();
                };
                grid.appendChild(hex);
            });
        }

        function updateHueSliderState() {
            const hueSlider = document.getElementById('hueSlider');
            if (modalSat < 1 || modalLight === 0 || modalLight === 100) {
                hueSlider.disabled = true;
            } else {
                hueSlider.disabled = false;
            }
        }

        function updateColorFromControls() {
            modalHue = parseInt(document.getElementById('hueSlider').value);
            modalLight = parseInt(document.getElementById('lightnessSlider').value);
            
            updateHueSliderState();
            
            const brightSlider = document.getElementById('lightnessSlider');
            brightSlider.style.background = `linear-gradient(to right, black, hsl(${modalHue}, ${modalSat}%, 50%), white)`;

            tempColor = HSLToHex(modalHue, modalSat, modalLight);
            
            document.getElementById('modalColorPreview').style.backgroundColor = tempColor;
            document.getElementById('modalHexInput').value = tempColor.replace('#', '').toUpperCase();
        }

        function updateFromHexInput(val) {
            if(val.length === 6) {
                const hex = '#' + val;
                const hsl = hexToHSL(hex);
                modalHue = hsl.h;
                modalSat = hsl.s;
                modalLight = hsl.l;
                
                document.getElementById('hueSlider').value = modalHue;
                document.getElementById('lightnessSlider').value = modalLight;
                
                const brightSlider = document.getElementById('lightnessSlider');
                brightSlider.style.background = `linear-gradient(to right, black, hsl(${modalHue}, ${modalSat}%, 50%), white)`;
                
                document.getElementById('modalColorPreview').style.backgroundColor = hex;
                tempColor = hex;
                updateHueSliderState();
            }
        }

        function hexToHSL(H) {
            let r = 0, g = 0, b = 0;
            if (H.length == 4) {
                r = "0x" + H[1] + H[1];
                g = "0x" + H[2] + H[2];
                b = "0x" + H[3] + H[3];
            } else if (H.length == 7) {
                r = "0x" + H[1] + H[2];
                g = "0x" + H[3] + H[4];
                b = "0x" + H[5] + H[6];
            }
            r /= 255; g /= 255; b /= 255;
            let cmin = Math.min(r,g,b),
                cmax = Math.max(r,g,b),
                delta = cmax - cmin,
                h = 0, s = 0, l = 0;
            if (delta == 0) h = 0;
            else if (cmax == r) h = ((g - b) / delta) % 6;
            else if (cmax == g) h = (b - r) / delta + 2;
            else h = (r - g) / delta + 4;
            h = Math.round(h * 60);
            if (h < 0) h += 360;
            l = (cmax + cmin) / 2;
            s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
            s = +(s * 100).toFixed(1);
            l = +(l * 100).toFixed(1);
            return { h, s, l };
        }

        function HSLToHex(h, s, l) {
            s /= 100;
            l /= 100;
            let c = (1 - Math.abs(2 * l - 1)) * s,
                x = c * (1 - Math.abs((h / 60) % 2 - 1)),
                m = l - c / 2,
                r = 0, g = 0, b = 0;
            if (0 <= h && h < 60) { r = c; g = x; b = 0; }
            else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
            else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
            else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
            else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
            else if (300 <= h && h < 360) { r = c; g = 0; b = x; }
            r = Math.round((r + m) * 255).toString(16);
            g = Math.round((g + m) * 255).toString(16);
            b = Math.round((b + m) * 255).toString(16);
            if (r.length == 1) r = "0" + r;
            if (g.length == 1) g = "0" + g;
            if (b.length == 1) b = "0" + b;
            return "#" + r + g + b;
        }

        // --- FURNITURE LOGIC ---
        function setMode(mode) {
            layoutMode = mode;
            const canvas = document.getElementById('roomCanvas');
            const btnMove = document.getElementById('btnMoveMode');
            const btnDraw = document.getElementById('btnDrawMode');
            if (mode === 'move') {
                canvas.classList.remove('draw-mode');
                canvas.classList.add('move-mode');
                btnMove.classList.add('active-mode');
                btnDraw.classList.remove('active-mode');
            } else {
                canvas.classList.remove('move-mode');
                canvas.classList.add('draw-mode');
                btnDraw.classList.add('active-mode');
                btnMove.classList.remove('active-mode');
            }
        }
        function addFurniture(iconClass) {
            setMode('move');
            const canvas = document.getElementById('roomCanvas');
            const piece = document.createElement('div');
            piece.className = 'furniture-piece';
            piece.innerHTML = `<i class="fas fa-${iconClass}"></i>`;
            piece.style.top = (canvas.clientHeight / 2 - 30 + (Math.random()*40-20)) + 'px';
            piece.style.left = (canvas.clientWidth / 2 - 30 + (Math.random()*40-20)) + 'px';
            canvas.appendChild(piece);
            makeDraggable(piece);
        }
        function clearRoom() {
            const canvas = document.getElementById('roomCanvas');
            const items = canvas.querySelectorAll('.furniture-piece');
            items.forEach(i => i.remove());
            const wallLayer = document.getElementById('wallLayer');
            wallLayer.innerHTML = '';
        }
        function makeDraggable(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;
            elmnt.ontouchstart = dragMouseDown;
            function dragMouseDown(e) {
                if(layoutMode === 'draw') return; 
                const evt = e.type === 'touchstart' ? e.touches[0] : e;
                pos3 = evt.clientX;
                pos4 = evt.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                document.ontouchend = closeDragElement;
                document.ontouchmove = elementDrag;
            }
            function elementDrag(e) {
                if(e.type === 'touchmove') { e.preventDefault(); }
                const evt = e.type === 'touchmove' ? e.touches[0] : e;
                pos1 = pos3 - evt.clientX;
                pos2 = pos4 - evt.clientY;
                pos3 = evt.clientX;
                pos4 = evt.clientY;
                let newTop = elmnt.offsetTop - pos2;
                let newLeft = elmnt.offsetLeft - pos1;
                const parent = document.getElementById('roomCanvas');
                if (newTop < 0) newTop = 0;
                if (newLeft < 0) newLeft = 0;
                if (newTop > parent.clientHeight - elmnt.clientHeight) newTop = parent.clientHeight - elmnt.clientHeight;
                if (newLeft > parent.clientWidth - elmnt.clientWidth) newLeft = parent.clientWidth - elmnt.clientWidth;
                elmnt.style.top = newTop + "px";
                elmnt.style.left = newLeft + "px";
            }
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
                document.ontouchend = null;
                document.ontouchmove = null;
            }
        }
        // --- WALL DRAWING LOGIC ---
        let isDrawing = false;
        let currentLine = null;
        function startWall(e) {
            if (layoutMode !== 'draw') return;
            if(e.type === 'touchstart') e.preventDefault();
            isDrawing = true;
            const svg = document.getElementById('wallLayer');
            const rect = svg.getBoundingClientRect();
            const evt = e.type === 'touchstart' ? e.touches[0] : e;
            const x = evt.clientX - rect.left;
            const y = evt.clientY - rect.top;
            currentLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            currentLine.setAttribute('x1', x);
            currentLine.setAttribute('y1', y);
            currentLine.setAttribute('x2', x);
            currentLine.setAttribute('y2', y);
            currentLine.setAttribute('stroke', 'white');
            currentLine.setAttribute('stroke-width', '4');
            currentLine.setAttribute('stroke-linecap', 'round');
            svg.appendChild(currentLine);
        }
        function drawWall(e) {
            if (!isDrawing || !currentLine) return;
            if(e.type === 'touchmove') e.preventDefault();
            const svg = document.getElementById('wallLayer');
            const rect = svg.getBoundingClientRect();
            const evt = e.type === 'touchmove' ? e.touches[0] : e;
            const x = evt.clientX - rect.left;
            const y = evt.clientY - rect.top;
            currentLine.setAttribute('x2', x);
            currentLine.setAttribute('y2', y);
        }
        function endWall(e) {
            isDrawing = false;
            currentLine = null;
        }

        // --- MAIN APP LOGIC ---
        function updateSize(val) {
            document.getElementById('sizeLabel').textContent = `Size: ${val}M²`;
            const scale = 0.8 + ((val - 30) / 50) * 0.3; 
            if (!isGenerating) {
                document.getElementById('houseSvg').style.transform = `scale(${scale})`;
            }
        }
        function selectMaterial(el, mat) {
            document.querySelectorAll('.mat-circle').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            currentMaterial = mat;
        }
        function selectColor(el, color) {
            document.querySelectorAll('.col-circle').forEach(c => c.classList.remove('active'));
            if(el) el.classList.add('active');
            currentColor = color;
            updateColorInfo(color);
            const paths = document.querySelectorAll('#houseSvg path, #houseSvg rect');
            paths.forEach(p => {
                p.style.fill = color;
                p.style.fillOpacity = "0.3"; 
            });
        }
        function applyCustomColor(color) {
            const btn = document.getElementById('customColorBtn');
            document.querySelectorAll('.col-circle').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            selectColor(null, color);
        }
        function updateColorInfo(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            document.getElementById('hexValue').textContent = hex.toUpperCase();
            document.getElementById('rgbValue').textContent = `${r}, ${g}, ${b}`;
            document.getElementById('colorInfo').classList.add('visible');
        }
        function startGeneration() {
            if (isGenerating) return;
            isGenerating = true;
            const btn = document.getElementById('generateBtn');
            const overlay = document.getElementById('constructionOverlay');
            const pBar = document.getElementById('progressBar');
            const pContainer = document.getElementById('progressContainer');
            const countText = document.getElementById('countdown');
            btn.disabled = true;
            btn.textContent = "Working...";
            overlay.classList.add('active');
            pContainer.style.display = 'block';
            pBar.style.width = '0%';
            let timeLeft = 10;
            countText.textContent = timeLeft + 's';
            const interval = setInterval(() => {
                timeLeft--;
                countText.textContent = timeLeft + 's';
                const percentage = ((10 - timeLeft) / 10) * 100;
                pBar.style.width = percentage + '%';
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    finishGeneration();
                }
            }, 1000);
        }
        function finishGeneration() {
            const btn = document.getElementById('generateBtn');
            const overlay = document.getElementById('constructionOverlay');
            document.getElementById('countdown').textContent = "DONE!";
            setTimeout(() => {
                isGenerating = false;
                btn.disabled = false;
                btn.textContent = "Generate";
                overlay.classList.remove('active');
                setTimeout(() => {
                   document.getElementById('progressContainer').style.display = 'none'; 
                }, 500);
            }, 1000);
        }
        updateSize(70);
    </script>
</body>
</html>
